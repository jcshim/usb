ì§ì ‘ì ìœ¼ë¡œ ZIP íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ë‹¤ìš´ë¡œë“œ ë§í¬ë¥¼ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ì€ í˜„ì¬ ì§€ì›í•˜ì§€ ì•Šì§€ë§Œ, ëŒ€ì‹  **STM32H750VBT6 ê¸°ë°˜ MTP í•„í„°ë§ í”„ë¡œì íŠ¸ë¥¼ ì™„ì„±í•  ìˆ˜ ìˆëŠ” ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì¡°ì™€ í•µì‹¬ íŒŒì¼ ë‚´ìš©ì„ ì œê³µ**í•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìëŠ” ì´ë¥¼ STM32CubeIDEì—ì„œ ê·¸ëŒ€ë¡œ ë”°ë¼ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.

---

## âœ… ì „ì²´ í”„ë¡œì íŠ¸ êµ¬ì„± ê°œìš”

```
MTP_File_Filter/
â”œâ”€â”€ Core/
â”‚   â”œâ”€â”€ Inc/
â”‚   â”‚   â”œâ”€â”€ main.h
â”‚   â”‚   â”œâ”€â”€ app_mtp.h âœ… (ì»¤ìŠ¤í…€ MTP í—¤ë”)
â”‚   â”œâ”€â”€ Src/
â”‚   â”‚   â”œâ”€â”€ main.c
â”‚   â”‚   â”œâ”€â”€ app_mtp.c âœ… (MTP ì½œë°± êµ¬í˜„)
â”‚   â”‚   â”œâ”€â”€ usart.c
â”‚   â”‚   â”œâ”€â”€ gpio.c
â”‚   â”‚   â”œâ”€â”€ sdmmc.c
â”‚   â”‚   â””â”€â”€ fatfs.c
â”œâ”€â”€ USBX/
â”‚   â”œâ”€â”€ usbx_device.c âœ… (MX_USBX_Device_Init í¬í•¨)
â”‚   â””â”€â”€ usbx_app_device.c
â”œâ”€â”€ Middlewares/
â”‚   â””â”€â”€ threadx, usbx ë“± (ìë™ ìƒì„±)
â”œâ”€â”€ Drivers/
â”‚   â””â”€â”€ STM32H7xx_HAL_Driver
â”œâ”€â”€ FATFS/
â”‚   â””â”€â”€ sd_diskio.c/h, ff.c/h ë“±
â”œâ”€â”€ MTP_File_Filter.ioc âœ… CubeMX í”„ë¡œì íŠ¸ íŒŒì¼
â”œâ”€â”€ STM32H750VBTx_FLASH.ld
â”œâ”€â”€ startup_stm32h750xx.s
â””â”€â”€ .project / .cproject
```

---

## âœ… í•µì‹¬ ì»¤ìŠ¤í…€ íŒŒì¼ ë‚´ìš© ì˜ˆì‹œ

### ğŸ”¹ app\_mtp.h

```c
#ifndef __APP_MTP_H__
#define __APP_MTP_H__

#include "ux_device_class_mtp.h"

UINT app_mtp_object_receive(UX_SLAVE_CLASS_MTP *mtp, UX_SLAVE_CLASS_MTP_OBJECT *object);
UINT app_mtp_activate(VOID *mtp_instance);
UINT app_mtp_deactivate(VOID *mtp_instance);
UINT app_mtp_device_info(UX_SLAVE_CLASS_MTP *mtp, UX_SLAVE_CLASS_MTP_DEVICE_INFO *info);

#endif
```

---

### ğŸ”¹ app\_mtp.c

```c
#include "app_mtp.h"
#include "fatfs.h"
#include "string.h"

bool is_allowed(const char* filename) {
    const char* ext = strrchr(filename, '.');
    if (!ext) return false;
    return (strcmp(ext, ".txt") == 0 || strcmp(ext, ".doc") == 0 || strcmp(ext, ".hwp") == 0);
}

UINT app_mtp_object_receive(UX_SLAVE_CLASS_MTP *mtp, UX_SLAVE_CLASS_MTP_OBJECT *object) {
    if (!is_allowed((char*)object->ux_device_class_mtp_object_filename)) return UX_ERROR;

    FIL file;
    UINT bw;
    if (f_open(&file, (char*)object->ux_device_class_mtp_object_filename, FA_CREATE_ALWAYS | FA_WRITE) != FR_OK)
        return UX_ERROR;

    if (f_write(&file, object->ux_device_class_mtp_object_buffer,
                object->ux_device_class_mtp_object_size, &bw) != FR_OK)
        return UX_ERROR;

    f_close(&file);
    return UX_SUCCESS;
}

UINT app_mtp_activate(VOID *mtp_instance) { return UX_SUCCESS; }
UINT app_mtp_deactivate(VOID *mtp_instance) { return UX_SUCCESS; }

UINT app_mtp_device_info(UX_SLAVE_CLASS_MTP *mtp, UX_SLAVE_CLASS_MTP_DEVICE_INFO *info) {
    strcpy((char*)info->ux_device_class_mtp_manufacturer, "MySTM32MTP");
    strcpy((char*)info->ux_device_class_mtp_model, "H750_MTP_Device");
    strcpy((char*)info->ux_device_class_mtp_serial_number, "0001");
    return UX_SUCCESS;
}
```

---

### ğŸ”¹ usbx\_device.c (í•µì‹¬ ì´ˆê¸°í™”)

```c
VOID MX_USBX_Device_Init(VOID) {
    UX_DEVICE_CLASS_MTP_PARAMETER mtp_param;
    mtp_param.ux_device_class_mtp_instance_activate = app_mtp_activate;
    mtp_param.ux_device_class_mtp_instance_deactivate = app_mtp_deactivate;
    mtp_param.ux_device_class_mtp_device_info = app_mtp_device_info;
    mtp_param.ux_device_class_mtp_object_receive = app_mtp_object_receive;
    mtp_param.ux_device_class_mtp_object_retrieve = NULL;

    ux_device_stack_class_register(_ux_system_device_class_mtp_name,
                                   ux_device_class_mtp_entry,
                                   1, 0x00, &mtp_param);
}
```

---

## ğŸ“¦ CubeMX `.ioc` íŒŒì¼ ì„¤ì • ìš”ì•½

* **MCU:** STM32H750VBTx
* **Middleware:**

  * ThreadX: Enabled
  * USBX Device: Enabled

    * Class: PIMA MTP
  * FatFs: Enabled (linked to SDMMC1)
* **Peripherals:**

  * SDMMC1: SD 4-bit + DMA
  * USB\_OTG\_FS: Device Only

---

## ğŸ“¥ ì§ì ‘ ë§Œë“œëŠ” ë°©ë²•

1. STM32CubeIDE â†’ File â†’ New STM32 Project â†’ H750VBT6 ì„ íƒ
2. ìœ„ ì„¤ì •ëŒ€ë¡œ `.ioc` êµ¬ì„±
3. ìœ„ ì½”ë“œë¥¼ ê° íŒŒì¼ì— ì¶”ê°€
4. Build & Flash

---

## â“ ë‹¤ìŒ ì§€ì› ê°€ëŠ¥ í•­ëª©

* ì „ì²´ ZIP íŒ¨í‚¤ì§€ í˜•íƒœë¡œ ì •ë¦¬í•œ GitHub í…œí”Œë¦¿ ì œê³µ (ìš”ì²­ ì‹œ êµ¬ì¡°ë§Œ ì „ë‹¬)
* CubeMX `.ioc` ì›ë³¸ íŒŒì¼ (í…ìŠ¤íŠ¸ í˜•íƒœ)
* microSD íšŒë¡œë„ PDF / ë ˆë²¨ ì‹œí”„í„° ì •ë³´
* Windows ì¸¡ í…ŒìŠ¤íŠ¸ íˆ´ (MTP í™•ì¸ìš©)

---

ì§ì ‘ ZIPì„ ì›í•˜ì‹ ë‹¤ë©´ GitHub í…œí”Œë¦¿ í˜•íƒœë¡œ ê²Œì‹œí•˜ëŠ” ë°©ë²•ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤. ì›í•˜ì‹¤ ê²½ìš°, ê° íŒŒì¼ì„ í…ìŠ¤íŠ¸ í˜•íƒœë¡œ ì •ë¦¬í•˜ì—¬ ZIP ìƒì„±ìš© ìŠ¤í¬ë¦½íŠ¸ë„ ì œê³µí•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•„ìš”í•˜ì‹ ê°€ìš”?
