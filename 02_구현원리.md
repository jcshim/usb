ìœˆë„ìš°ì—ì„œ íŒŒì¼ì„ USB ìŠ¤í‹±ì— ì €ì¥í•  ë•Œ **STM32ê°€ ì§ì ‘ íŒŒì¼ ì œì–´ì™€ í•„í„°ë§ì„ ìˆ˜í–‰**í•˜ë ¤ë©´, ë‹¤ìŒê³¼ ê°™ì€ ì•„í‚¤í…ì²˜ì™€ ë‹¨ê³„ê°€ í•„ìš”í•˜ë‹¤. í•µì‹¬ì€ **STM32ë¥¼ USB í˜¸ìŠ¤íŠ¸ë¡œ ì„¤ì •**í•˜ê³ , **PCì™€ USB ë©”ëª¨ë¦¬ ì‚¬ì´ì˜ ì¤‘ê°„ ê²Œì´íŠ¸ì›¨ì´**ë¡œ ë™ì‘ì‹œí‚¤ëŠ” ê²ƒì´ë‹¤.

### ğŸ“ **1. ì‹œìŠ¤í…œ êµ¬ì„±ë„**
```mermaid
graph LR
A[ìœˆë„ìš° PC] -- íŒŒì¼ ì „ì†¡ --> B[STM32]
B -- í•„í„°ë§ëœ íŒŒì¼ ì €ì¥ --> C[USB ë©”ëª¨ë¦¬]
B -- SD ì¹´ë“œ ì„ì‹œ ì €ì¥ --> D[MicroSD ì¹´ë“œ]
```

### âš™ï¸ **2. êµ¬í˜„ ì›ë¦¬**
#### (1) **STM32ì˜ ì´ì¤‘ ì—­í• **
- **USB ì¥ì¹˜ ëª¨ë“œ (PC ì—°ê²°)**:  
  STM32ê°€ PCì— **ê°€ìƒ USB ë“œë¼ì´ë¸Œ**ë¡œ ì¸ì‹ë˜ë„ë¡ ì„¤ì •.  
  â†’ PCëŠ” ì´ ë“œë¼ì´ë¸Œì— íŒŒì¼ì„ ë³µì‚¬í•˜ë©´, STM32ì˜ SD ì¹´ë“œë¡œ ìë™ ì €ì¥.
- **USB í˜¸ìŠ¤íŠ¸ ëª¨ë“œ (ë©”ëª¨ë¦¬ ì œì–´)**:  
  STM32ê°€ USB ë©”ëª¨ë¦¬ë¥¼ ì§ì ‘ ì œì–´í•˜ë©°, SD ì¹´ë“œì—ì„œ í•„í„°ë§ëœ íŒŒì¼(`.hwp`, `.doc`)ë§Œ ì„ íƒí•˜ì—¬ ë³µì‚¬.

#### (2) **í•„í„°ë§ ìë™í™” í”„ë¡œì„¸ìŠ¤**
1. **PC â†’ STM32 ê°€ìƒ ë“œë¼ì´ë¸Œì— íŒŒì¼ ë³µì‚¬**  
   - ì‚¬ìš©ìê°€ PCì—ì„œ íŒŒì¼ì„ STM32ì˜ ê°€ìƒ ë“œë¼ì´ë¸Œ(`F:\` ë“±)ë¡œ ë“œë˜ê·¸ ì•¤ ë“œë¡­.
   - STM32ëŠ” ì´ íŒŒì¼ì„ **SD ì¹´ë“œì— ì„ì‹œ ì €ì¥**.

2. **STM32ì˜ ë°±ê·¸ë¼ìš´ë“œ í•„í„°ë§ ì‘ì—…**  
   ```c
   void background_task() {
       while (1) {
           if (files_in_sd_card()) { // SD ì¹´ë“œì— ìƒˆ íŒŒì¼ ì¡´ì¬ ì‹œ
               filter_and_copy_to_usb(); // í™•ì¥ì í•„í„°ë§ í›„ USB ë©”ëª¨ë¦¬ ë³µì‚¬
           }
           osDelay(1000); // 1ì´ˆë§ˆë‹¤ ê²€ì‚¬ (FreeRTOS ì‚¬ìš© ì‹œ)
       }
   }
   ```

3. **í•„í„°ë§ ë¡œì§ (`filter_and_copy_to_usb` í•¨ìˆ˜)**  
   - SD ì¹´ë“œì˜ íŒŒì¼ ëª©ë¡ì„ ìŠ¤ìº” â†’ `.hwp`, `.doc` í™•ì¥ìë§Œ ì„ íƒ.
   - USB ë©”ëª¨ë¦¬ë¡œ ë³µì‚¬ í›„, SD ì¹´ë“œì˜ ì„ì‹œ íŒŒì¼ ì‚­ì œ.

### ğŸ”Œ **3. í•˜ë“œì›¨ì–´ ì—°ê²° ì˜ˆì‹œ**
| STM32 í•€       | ì—°ê²° ëŒ€ìƒ         | ê¸°ëŠ¥                     |
|----------------|-------------------|--------------------------|
| **USB_OTG_HS** | PC (ë§ˆì´í¬ë¡œ USB) | ì¥ì¹˜ ëª¨ë“œ (ê°€ìƒ ë“œë¼ì´ë¸Œ) |
| **USB_OTG_FS** | USB ë©”ëª¨ë¦¬        | í˜¸ìŠ¤íŠ¸ ëª¨ë“œ (ì§ì ‘ ì œì–´)   |
| **SDMMC1**     | MicroSD ì¹´ë“œ      | ì„ì‹œ ì €ì¥ì†Œ              |

> ğŸ’¡ **ì£¼ì˜**: STM32H750ì€ HS(High-Speed)ì™€ FS(Full-Speed) USB í¬íŠ¸ë¥¼ ë™ì‹œ ì§€ì›.

### ğŸ› ï¸ **4. íŒì›¨ì–´ êµ¬í˜„ í•µì‹¬ ì½”ë“œ**
#### (1) **USB ì¥ì¹˜ ëª¨ë“œ ì„¤ì • (PC ì¸ì‹)**
```c
// STM32CubeMX ìƒì„± ì½”ë“œ
USBD_Init(&hUsbDeviceHS, &MSC_Desc, DEVICE_HS);
USBD_RegisterClass(&hUsbDeviceHS, &USBD_MSC);
USBD_MSC_RegisterStorage(&hUsbDeviceHS, &USBD_Storage_Interface_fops);
```

#### (2) **USB í˜¸ìŠ¤íŠ¸ ëª¨ë“œ ì„¤ì • (ë©”ëª¨ë¦¬ ì œì–´)**
```c
USBH_Init(&hUsbHostFS, USBH_MSC_Class, &hUsbHostFS_Config);
USBH_RegisterDriver(&hUsbHostFS, &USBH_MSC_Driver);
USBH_Start(&hUsbHostFS);
```

#### (3) **íŒŒì¼ í•„í„°ë§ ë° ë³µì‚¬**
```c
void filter_and_copy_to_usb() {
    DIR dir;
    FILINFO file_info;
    f_opendir(&dir, "/"); // SD ì¹´ë“œ ë£¨íŠ¸ íƒìƒ‰

    while (f_readdir(&dir, &file_info) == FR_OK) {
        if (file_info.fname[0] == 0) break; // ì¢…ë£Œ ì¡°ê±´
        
        // .hwp/.doc íŒŒì¼ë§Œ ì„ íƒ
        if (strstr(file_info.fname, ".hwp") || 
            strstr(file_info.fname, ".doc")) {
            
            // USB ë©”ëª¨ë¦¬ë¡œ ë³µì‚¬
            copy_to_usb_memory(file_info.fname);
            
            // ì²˜ë¦¬ í›„ SD ì¹´ë“œ íŒŒì¼ ì‚­ì œ
            f_unlink(file_info.fname);
        }
    }
    f_closedir(&dir);
}
```

### âš ï¸ **5. ì‚¬ìš©ì ê²½í—˜ ìµœì í™”**
- **ì§„í–‰ ìƒíƒœ í‘œì‹œ**:  
  STM32ì˜ LEDë‚˜ UART ì¶œë ¥ìœ¼ë¡œ í•„í„°ë§ ì§„í–‰ ìƒí™© ì•Œë¦¼.
- **ìë™ ì‹œì‘**:  
  USB ë©”ëª¨ë¦¬ ì—°ê²° ì‹œ ìë™ ë³µì‚¬ ì‹œì‘ (USB í˜¸ìŠ¤íŠ¸ ê°ì§€ ì½œë°± í™œìš©).
- **ì—ëŸ¬ ì²˜ë¦¬**:  
  USB ë©”ëª¨ë¦¬ ê½‰ ì°¸ â†’ PCì— ì˜¤ë¥˜ ì•Œë¦¼ (ê°€ìƒ COM í¬íŠ¸ í™œìš©).

### âœ… **6. ë™ì‘ ì‹œë‚˜ë¦¬ì˜¤**
1. ì‚¬ìš©ìê°€ `report.hwp`, `photo.jpg`, `data.doc`ë¥¼ STM32 ê°€ìƒ ë“œë¼ì´ë¸Œ(`F:\`)ì— ë³µì‚¬.
2. STM32ëŠ” SD ì¹´ë“œì— íŒŒì¼ ì €ì¥ â†’ ë°±ê·¸ë¼ìš´ë“œì—ì„œ `report.hwp`, `data.doc`ë§Œ í•„í„°ë§.
3. í•„í„°ë§ëœ íŒŒì¼ì´ USB ë©”ëª¨ë¦¬(`G:\`)ì— ì €ì¥ë˜ê³ , SD ì¹´ë“œ íŒŒì¼ì€ ì‚­ì œë¨.
4. ì‚¬ìš©ìëŠ” USB ë©”ëª¨ë¦¬ì—ì„œ **hwp/doc íŒŒì¼ë§Œ í™•ì¸ ê°€ëŠ¥**.

### ğŸ“Œ **ê²°ë¡ **
- **ê°€ëŠ¥ ì—¬ë¶€**:  
  ìœˆë„ìš°ì—ì„œ íŒŒì¼ì„ **í•œêº¼ë²ˆì— ë³µì‚¬ â†’ STM32ê°€ í•„í„°ë§ â†’ USB ë©”ëª¨ë¦¬ ì €ì¥** ê°€ëŠ¥.
- **í•„ìš” ì¡°ê±´**:  
  STM32ì˜ **ì´ì¤‘ USB ëª¨ë“œ ì§€ì›** + **FATFS ë¯¸ë“¤ì›¨ì–´ ì—°ë™**.
- **ì¶”ì²œ ë³´ë“œ**:  
  STM32H750VBT6 (USB HS/FS ë™ì‹œ ì§€ì›, 480Mbps ê³ ì† ì „ì†¡).

> ğŸ”§ **êµ¬í˜„ íŒ**:  
> STM32CubeMXì—ì„œ `USB_OTG_HS` (Device) + `USB_OTG_FS` (Host) + `SDMMC1` (SD ì¹´ë“œ) í™œì„±í™” í›„,  
> FreeRTOSë¡œ ë°±ê·¸ë¼ìš´ë“œ íƒœìŠ¤í¬ë¥¼ ìƒì„±í•´ í•„í„°ë§ì„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´ íš¨ìœ¨ì ì´ë‹¤.

[1] https://www.youtube.com/watch?v=52BATyJrmeg
[2] https://www.youtube.com/watch?v=pD8Lty7bP7M
[3] https://www.instructables.com/Advanced-file-copying-with-batch-files/
[4] https://www.howtogeek.com/685516/how-to-copy-files-to-a-usb-flash-drive-on-windows-10/
[5] https://www.integralmemory.com/faq1/how-do-i-copy-my-files-and-documents-to-the-usb-flash-drive/
[6] https://www.reddit.com/r/windows/comments/5rv804/copying_large_amounts_of_files_between_pcs_via/
[7] https://answers.microsoft.com/en-us/windows/forum/all/unable-to-copy-all-files-to-usb-flash-drive/3ac8d569-ae0e-4eca-8649-fea96dd6a0b3
[8] https://superuser.com/questions/1693295/fastest-way-on-windows-to-copy-38gb-of-files-to-50-usb-drives
[9] https://stackoverflow.com/questions/56053230/how-to-copy-a-file-from-a-usb-drive-to-c-drive-in-windows-10-using-a-batch-file
[10] https://superuser.com/questions/22766/how-can-i-automatically-copy-files-to-a-usb-drive-when-i-connect-it-to-my-comput
